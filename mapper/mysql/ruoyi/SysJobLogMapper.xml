<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper/mysql/ruoyi/SysJobLogMapper.xml">

    <!-- 查询调度日志列表 -->
    <select id="selectJobLogList">
        SELECT 
            job_log_id,
            job_name,
            job_group,
            invoke_target,
            job_message,
            status,
            exception_info,
            create_time
        FROM sys_job_log
        <where>
            <if test="jobName">
                AND job_name LIKE CONCAT('%', #{jobName}, '%')
            </if>
            <if test="jobGroup">
                AND job_group = #{jobGroup}
            </if>
            <if test="status">
                AND status = #{status}
            </if>
            <if test="beginTime">
                AND DATE_FORMAT(create_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{beginTime}, '%Y-%m-%d')
            </if>
            <if test="endTime">
                AND DATE_FORMAT(create_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{endTime}, '%Y-%m-%d')
            </if>
        </where>
        ORDER BY create_time DESC
        LIMIT ?, ?
    </select>

    <!-- 查询调度日志总数 -->
    <select id="countJobLogList">
        SELECT COUNT(*) as count
        FROM sys_job_log
        <where>
            <if test="jobName">
                AND job_name LIKE CONCAT('%', #{jobName}, '%')
            </if>
            <if test="jobGroup">
                AND job_group = #{jobGroup}
            </if>
            <if test="status">
                AND status = #{status}
            </if>
            <if test="beginTime">
                AND DATE_FORMAT(create_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{beginTime}, '%Y-%m-%d')
            </if>
            <if test="endTime">
                AND DATE_FORMAT(create_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{endTime}, '%Y-%m-%d')
            </if>
        </where>
    </select>

    <!-- 根据ID查询调度日志 -->
    <select id="selectJobLogById">
        SELECT 
            job_log_id,
            job_name,
            job_group,
            invoke_target,
            job_message,
            status,
            exception_info,
            create_time
        FROM sys_job_log
        WHERE job_log_id = ?
    </select>

    <!-- 新增调度日志 -->
    <insert id="insertJobLog">
        INSERT INTO sys_job_log (
            job_name,
            job_group,
            invoke_target,
            job_message,
            status,
            exception_info,
            create_time
        ) VALUES (
            #{jobName},
            #{jobGroup},
            #{invokeTarget},
            #{jobMessage},
            #{status},
            #{exceptionInfo},
            #{createTime}
        )
    </insert>

    <!-- 批量删除调度日志 -->
    <delete id="deleteJobLogByIds">
        DELETE FROM sys_job_log
        WHERE job_log_id IN
        <foreach collection="array" item="jobLogId" open="(" separator="," close=")">
            #{jobLogId}
        </foreach>
    </delete>

    <!-- 清空调度日志 -->
    <delete id="cleanJobLog">
        TRUNCATE TABLE sys_job_log
    </delete>

</mapper>

