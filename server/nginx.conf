server {
    listen       80;
    server_name  www.undsky.com undsky.com;

    # 反向代理
    location / {
        proxy_pass http://localhost:7001;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;
        proxy_redirect off;
        # 超时时间：3分钟
        proxy_connect_timeout 180s;
        proxy_send_timeout 180s;
        proxy_read_timeout 180s;
    }

    # 反向代理子路径
    location ^~ /subpath/ {
        proxy_pass http://localhost:7002/;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;
        proxy_redirect off;
        # 超时时间：3分钟
        proxy_connect_timeout 180s;
        proxy_send_timeout 180s;
        proxy_read_timeout 180s;
    }

    # H5
    location ^~ /h5 {
        alias /项目目录/h5;
        index index.html index.htm;
        # autoindex on;
        add_header Cache-Control no-cache; # 禁止缓存首页
    }

    # admin
    location ^~ /admin {
        alias /项目目录/admin;
        index index.html index.htm;
        # autoindex on;
        add_header Cache-Control no-cache; # 禁止缓存首页
    }

    # 处理静态内容
    location ~ ^/(images/|img/|javascript/|js/|css/|stylesheets/|flash/|media/|static/|robots.txt|humans.txt|favicon.ico) {
        root /项目目录/public;
        expires max;
    }

    access_log off;
    error_log  off;
}