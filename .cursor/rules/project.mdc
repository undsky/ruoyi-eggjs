---
alwaysApply: true
---

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: ruoyi-eggjs  
**ç‰ˆæœ¬**: 1.1.0  
**æè¿°**: åŸºäº Egg.js çš„ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿï¼Œå‚ç…§è‹¥ä¾ï¼ˆRuoYiï¼‰æ¶æ„è®¾è®¡  
**ä½œè€…**: å§œå½¦æ±  
**å®˜ç½‘**: https://www.undsky.com  
**ä»“åº“**: https://github.com/undsky/ruoyi-eggjs  
**åè®®**: MIT

### æ ¸å¿ƒç‰¹æ€§

- ğŸ—„ï¸ MyBatis XML é£æ ¼çš„ SQL æ˜ å°„
- ğŸ¤– åŸºäº XML Mapper çš„ä»£ç è‡ªåŠ¨ç”Ÿæˆ
- ğŸ¯ è£…é¥°å™¨è·¯ç”±ï¼ˆ@Routeã€@HttpGetã€@HttpPost ç­‰ï¼‰
- ğŸ” JWT è®¤è¯æˆæƒ
- ğŸ”’ æƒé™æ§åˆ¶è£…é¥°å™¨ï¼ˆ@RequiresPermissionsã€@RequiresRolesï¼‰
- ğŸš€ å¤šå±‚çº§ç¼“å­˜ï¼ˆMemoryã€Fileã€Redisï¼‰
- ğŸ›¡ï¸ API é™æµä¿æŠ¤
- ğŸ“¦ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- ğŸ“ ç»Ÿä¸€å“åº”æ ¼å¼åŒ–

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Node.js**: >=20.0.0
- **Egg.js**: ^3.x - ä¼ä¸šçº§ Node.js æ¡†æ¶
- **MySQL**: >=5.7 æˆ– MariaDB >=10.2
- **Redis**: >=5.0ï¼ˆå¯é€‰ï¼‰

### ä¸»è¦ä¾èµ–
- **egg-decorator-router**: ^1.0.7 - è£…é¥°å™¨è·¯ç”±
- **egg-jwt**: ^3.1.7 - JWT è®¤è¯
- **egg-cors**: ^3.0.0 - è·¨åŸŸæ”¯æŒ
- **bcryptjs**: ^2.4.3 - å¯†ç åŠ å¯†
- **dayjs**: ^1.11.10 - æ—¥æœŸå¤„ç†
- **lodash**: ^4.17.21 - å·¥å…·å‡½æ•°åº“
- **nanoid**: ^3.3.7 - å”¯ä¸€ ID ç”Ÿæˆ
- **fs-extra**: ^11.2.0 - æ–‡ä»¶ç³»ç»Ÿå¢å¼º
- **trek-captcha**: ^0.4.0 - éªŒè¯ç ç”Ÿæˆ

### è‡ªç ”æ’ä»¶
- **ruoyi-eggjs-mybatis**: MyBatis XML SQL æ˜ å°„
- **ruoyi-eggjs-mysql**: MySQL æ•°æ®åº“æ“ä½œ
- **ruoyi-eggjs-cache**: å¤šå±‚çº§ç¼“å­˜ç®¡ç†
- **ruoyi-eggjs-ratelimiter**: API é™æµ
- **ruoyi-eggjs-cli**: ä»£ç ç”Ÿæˆå‘½ä»¤è¡Œå·¥å…·
- **ruoyi-eggjs-sqlite**: SQLite æ•°æ®åº“æ”¯æŒ
- **ruoyi-eggjs-handlebars**: Handlebars æ¨¡æ¿å¼•æ“

---

## é¡¹ç›®ç»“æ„

```
ruoyi-eggjs/
â”œâ”€â”€ app/                          # åº”ç”¨ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ controller/               # æ§åˆ¶å™¨ï¼ˆAPI å…¥å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ api/                  # å…¬å…± API
â”‚   â”‚   â”œâ”€â”€ system/               # ç³»ç»Ÿç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ login.js          # ç™»å½•è®¤è¯
â”‚   â”‚   â”‚   â”œâ”€â”€ user.js           # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ role.js           # è§’è‰²ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ menu.js           # èœå•ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ dept.js           # éƒ¨é—¨ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ post.js           # å²—ä½ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ config.js         # å‚æ•°é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ dictType.js       # å­—å…¸ç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ dictData.js       # å­—å…¸æ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ notice.js         # é€šçŸ¥å…¬å‘Š
â”‚   â”‚   â”‚   â””â”€â”€ profile.js        # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ monitor/              # ç³»ç»Ÿç›‘æ§æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ online.js         # åœ¨çº¿ç”¨æˆ·
â”‚   â”‚   â”‚   â”œâ”€â”€ logininfor.js     # ç™»å½•æ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ operlog.js        # æ“ä½œæ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ job.js            # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ jobLog.js         # ä»»åŠ¡æ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ server.js         # æœåŠ¡ç›‘æ§
â”‚   â”‚   â”‚   â””â”€â”€ cache.js          # ç¼“å­˜ç›‘æ§
â”‚   â”‚   â”œâ”€â”€ tool/                 # ç³»ç»Ÿå·¥å…·æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ gen.js            # ä»£ç ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ common.js             # å…¬å…±æ§åˆ¶å™¨ï¼ˆä¸Šä¼ ä¸‹è½½ï¼‰
â”‚   â”œâ”€â”€ service/                  # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ db/                   # æ•°æ®åº“æœåŠ¡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ mysql/
â”‚   â”‚   â”‚       â””â”€â”€ ruoyi/        # è‹¥ä¾ç³»ç»Ÿè¡¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ system/               # ç³»ç»ŸæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ monitor/              # ç›‘æ§æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ tool/                 # å·¥å…·æœåŠ¡
â”‚   â”‚   â””â”€â”€ upload.js             # ä¸Šä¼ æœåŠ¡
â”‚   â”œâ”€â”€ decorator/                # è‡ªå®šä¹‰è£…é¥°å™¨
â”‚   â”‚   â””â”€â”€ permission.js         # æƒé™æ§åˆ¶è£…é¥°å™¨
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ accessControl.js      # è®¿é—®æ§åˆ¶ï¼ˆJWT éªŒè¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ formatBody.js         # å“åº”æ ¼å¼åŒ–
â”‚   â”‚   â””â”€â”€ permission.js         # æƒé™éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ extend/                   # æ‰©å±•
â”‚   â”‚   â””â”€â”€ helper.js             # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ constant/                 # å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.js              # ç³»ç»Ÿå¸¸é‡
â”‚   â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ uploads/              # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”‚   â””â”€â”€ favicon.ico           # ç½‘ç«™å›¾æ ‡
â”‚   â””â”€â”€ schedule/                 # å®šæ—¶ä»»åŠ¡ï¼ˆEgg.js åŸç”Ÿï¼‰
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.default.js         # é»˜è®¤é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒï¼‰
â”‚   â”œâ”€â”€ config.local.js           # æœ¬åœ°å¼€å‘é…ç½®
â”‚   â”œâ”€â”€ config.prod.js            # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ plugin.js                 # æ’ä»¶é…ç½®
â”œâ”€â”€ mapper/                       # MyBatis XML æ˜ å°„æ–‡ä»¶
â”‚   â””â”€â”€ mysql/
â”‚       â””â”€â”€ ruoyi/                # è‹¥ä¾ç³»ç»Ÿè¡¨ Mapper
â”‚           â”œâ”€â”€ SysUserMapper.xml
â”‚           â”œâ”€â”€ SysRoleMapper.xml
â”‚           â”œâ”€â”€ SysMenuMapper.xml
â”‚           â”œâ”€â”€ SysDeptMapper.xml
â”‚           â”œâ”€â”€ SysPostMapper.xml
â”‚           â”œâ”€â”€ SysConfigMapper.xml
â”‚           â”œâ”€â”€ SysDictTypeMapper.xml
â”‚           â”œâ”€â”€ SysDictDataMapper.xml
â”‚           â”œâ”€â”€ SysNoticeMapper.xml
â”‚           â”œâ”€â”€ SysLogininforMapper.xml
â”‚           â”œâ”€â”€ SysOperLogMapper.xml
â”‚           â”œâ”€â”€ SysJobLogMapper.xml
â”‚           â”œâ”€â”€ SysRoleMenuMapper.xml
â”‚           â”œâ”€â”€ SysRoleDeptMapper.xml
â”‚           â”œâ”€â”€ SysUserRoleMapper.xml
â”‚           â””â”€â”€ SysUserPostMapper.xml
â”œâ”€â”€ docs/                         # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ API_MAPPING.md            # API æ˜ å°„æ–‡æ¡£
â”‚   â”œâ”€â”€ PERMISSION_GUIDE.md       # æƒé™æ§åˆ¶å®Œæ•´æŒ‡å—
â”‚   â”œâ”€â”€ PERMISSION_QUICK_START.md # æƒé™æ§åˆ¶å¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€â”€ PERMISSION_IMPLEMENTATION.md # æƒé™æ§åˆ¶å®ç°ç»†èŠ‚
â”‚   â”œâ”€â”€ AUTH_MODULE_README.md     # è®¤è¯æ¨¡å—è¯´æ˜
â”‚   â”œâ”€â”€ QUICK_START_AUTH.md       # è®¤è¯å¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€â”€ *_MANAGEMENT_API.md       # å„æ¨¡å— API æ–‡æ¡£
â”‚   â””â”€â”€ *_MODULE_COMPLETED.md     # å„æ¨¡å—å®ŒæˆçŠ¶æ€
â”œâ”€â”€ cache/                        # æ–‡ä»¶ç¼“å­˜ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ logs/                         # æ—¥å¿—ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ run/                          # è¿›ç¨‹ PID æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ lib/                          # ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰åº“
â”œâ”€â”€ typings/                      # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ .dtpl/                        # ä»£ç æ¨¡æ¿ï¼ˆVSCode dot-templateï¼‰
â”œâ”€â”€ package.json                  # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ jsconfig.json                 # JavaScript é…ç½®
â”œâ”€â”€ .eslintrc                     # ESLint é…ç½®
â”œâ”€â”€ .babelrc                      # Babel é…ç½®ï¼ˆè£…é¥°å™¨æ”¯æŒï¼‰
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## ä»£ç è§„èŒƒ

### 1. å‘½åè§„èŒƒ

#### æ–‡ä»¶å‘½å
- **Controller**: é©¼å³°å‘½åï¼Œå¦‚ `user.js`ã€`dictType.js`
- **Service**: ä¸ Controller å¯¹åº”ï¼Œå¦‚ `user.js`ã€`dictType.js`
- **Mapper XML**: å¸•æ–¯å¡å‘½åï¼Œå¦‚ `SysUserMapper.xml`
- **è‡ªåŠ¨ç”Ÿæˆçš„ Service**: ä¸ Mapper XML å¯¹åº”ï¼Œå¦‚ `SysUserMapper.js`

#### å˜é‡å‘½å
- **é©¼å³°å‘½å**: `userName`ã€`roleId`ã€`deptName`
- **å¸¸é‡**: å¤§å†™ä¸‹åˆ’çº¿ï¼Œå¦‚ `MAX_SIZE`ã€`DEFAULT_VALUE`
- **ç§æœ‰å˜é‡**: ä¸‹åˆ’çº¿å‰ç¼€ï¼Œå¦‚ `_cache`ã€`_config`

#### å‡½æ•°å‘½å
- **å¢**: `add`ã€`create`ã€`insert`
- **åˆ **: `remove`ã€`delete`
- **æ”¹**: `edit`ã€`update`ã€`modify`
- **æŸ¥**: `list`ã€`get`ã€`select`ã€`query`
- **æŸ¥è¯¢åˆ—è¡¨**: `selectXxxList`
- **æŸ¥è¯¢å•æ¡**: `selectXxxById`

### 2. ä»£ç ç»“æ„

#### Controller ç»“æ„
```javascript
const Controller = require('egg').Controller;
const { Route, HttpGet, HttpPost, HttpPut, HttpDelete } = require('egg-decorator-router');
const { RequiresPermissions } = require('../../decorator/permission');

module.exports = app => {
  @Route('/api/system/xxx')
  class XxxController extends Controller {
    
    /**
     * æŸ¥è¯¢åˆ—è¡¨
     * GET /api/system/xxx/list
     * æƒé™ï¼šsystem:xxx:list
     */
    @RequiresPermissions('system:xxx:list')
    @HttpGet('/list')
    async list() {
      const { ctx } = this;
      const { pageNum = 1, pageSize = 10 } = ctx.request.body;
      
      const result = await ctx.service.system.xxx.selectXxxList(
        ctx.helper.page(ctx.request.body),
        ctx.request.body
      );
      
      ctx.body = result;
    }
    
    /**
     * æŸ¥è¯¢è¯¦æƒ…
     * GET /api/system/xxx/:id
     */
    @RequiresPermissions('system:xxx:query')
    @HttpGet('/:id')
    async getInfo() {
      const { ctx } = this;
      const result = await ctx.service.system.xxx.selectXxxById(ctx.params.id);
      ctx.body = result;
    }
    
    /**
     * æ–°å¢
     * POST /api/system/xxx
     */
    @RequiresPermissions('system:xxx:add')
    @HttpPost('/')
    async add() {
      const { ctx } = this;
      const result = await ctx.service.system.xxx.insertXxx(ctx.request.body);
      ctx.body = result;
    }
    
    /**
     * ä¿®æ”¹
     * PUT /api/system/xxx
     */
    @RequiresPermissions('system:xxx:edit')
    @HttpPut('/')
    async edit() {
      const { ctx } = this;
      const result = await ctx.service.system.xxx.updateXxx(ctx.request.body);
      ctx.body = result;
    }
    
    /**
     * åˆ é™¤
     * DELETE /api/system/xxx/:ids
     */
    @RequiresPermissions('system:xxx:remove')
    @HttpDelete('/:ids')
    async remove() {
      const { ctx } = this;
      const ids = ctx.params.ids.split(',');
      const result = await ctx.service.system.xxx.deleteXxxByIds(ids);
      ctx.body = result;
    }
  }
  
  return XxxController;
};
```

#### Service ç»“æ„
```javascript
const Service = require('egg').Service;

class XxxService extends Service {
  
  /**
   * æŸ¥è¯¢åˆ—è¡¨
   */
  async selectXxxList(values, params) {
    const { ctx } = this;
    // è°ƒç”¨è‡ªåŠ¨ç”Ÿæˆçš„ DB Service
    const result = await ctx.service.db.mysql.ruoyi.sysXxxMapper.selectXxxList(
      values,
      params
    );
    return result;
  }
  
  /**
   * æŸ¥è¯¢è¯¦æƒ…
   */
  async selectXxxById(id) {
    const { ctx } = this;
    const result = await ctx.service.db.mysql.ruoyi.sysXxxMapper.selectXxxById([id]);
    return result[0] || null;
  }
  
  /**
   * æ–°å¢
   */
  async insertXxx(data) {
    const { ctx } = this;
    const result = await ctx.service.db.mysql.ruoyi.sysXxxMapper.insertXxx([data]);
    return { code: 200, msg: 'æ–°å¢æˆåŠŸ', data: result };
  }
  
  /**
   * ä¿®æ”¹
   */
  async updateXxx(data) {
    const { ctx } = this;
    const result = await ctx.service.db.mysql.ruoyi.sysXxxMapper.updateXxx([data]);
    return { code: 200, msg: 'ä¿®æ”¹æˆåŠŸ', data: result };
  }
  
  /**
   * åˆ é™¤
   */
  async deleteXxxByIds(ids) {
    const { ctx } = this;
    const result = await ctx.service.db.mysql.ruoyi.sysXxxMapper.deleteXxxByIds([ids]);
    return { code: 200, msg: 'åˆ é™¤æˆåŠŸ', data: result };
  }
}

module.exports = XxxService;
```

#### Mapper XML ç»“æ„
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.mysql.ruoyi.SysXxxMapper">

    <!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— -->
    <sql id="selectXxxVo">
        select xxx_id, xxx_name, create_time, update_time
        from sys_xxx
    </sql>

    <!-- æŸ¥è¯¢åˆ—è¡¨ -->
    <select id="selectXxxList" parameterType="SysXxx" resultType="SysXxx">
        <include refid="selectXxxVo"/>
        <where>
            <if test="xxxName != null and xxxName != ''">
                AND xxx_name like concat('%', #{xxxName}, '%')
            </if>
        </where>
        order by create_time desc
        <if test="pageNum != null and pageSize != null">
            limit #{offset}, #{pageSize}
        </if>
    </select>

    <!-- æŸ¥è¯¢è¯¦æƒ… -->
    <select id="selectXxxById" parameterType="Long" resultType="SysXxx">
        <include refid="selectXxxVo"/>
        where xxx_id = #{xxxId}
    </select>

    <!-- æ–°å¢ -->
    <insert id="insertXxx" parameterType="SysXxx" useGeneratedKeys="true" keyProperty="xxxId">
        insert into sys_xxx
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="xxxName != null and xxxName != ''">xxx_name,</if>
            <if test="createBy != null">create_by,</if>
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="xxxName != null and xxxName != ''">#{xxxName},</if>
            <if test="createBy != null">#{createBy},</if>
            sysdate()
        </trim>
    </insert>

    <!-- ä¿®æ”¹ -->
    <update id="updateXxx" parameterType="SysXxx">
        update sys_xxx
        <set>
            <if test="xxxName != null and xxxName != ''">xxx_name = #{xxxName},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            update_time = sysdate()
        </set>
        where xxx_id = #{xxxId}
    </update>

    <!-- åˆ é™¤ -->
    <delete id="deleteXxxByIds" parameterType="Long">
        delete from sys_xxx where xxx_id in
        <foreach collection="array" item="xxxId" open="(" separator="," close=")">
            #{xxxId}
        </foreach>
    </delete>

</mapper>
```

### 3. æƒé™æ§åˆ¶è£…é¥°å™¨

#### @RequiresPermissions - æƒé™éªŒè¯
```javascript
// å•ä¸ªæƒé™
@RequiresPermissions('system:user:list')

// å¤šä¸ªæƒé™ï¼ˆAND é€»è¾‘ - éœ€è¦åŒæ—¶å…·å¤‡ï¼‰
@RequiresPermissions(['system:user:list', 'system:user:query'], 'AND')

// å¤šä¸ªæƒé™ï¼ˆOR é€»è¾‘ - å…·å¤‡å…¶ä¸€å³å¯ï¼‰
@RequiresPermissions(['system:user:list', 'system:user:query'], 'OR')

// é€šé…ç¬¦æƒé™
@RequiresPermissions('system:*:*')  // æ‰€æœ‰ system æ¨¡å—æƒé™
@RequiresPermissions('*:*:*')       // æ‰€æœ‰æƒé™ï¼ˆç®¡ç†å‘˜ï¼‰
```

#### @RequiresRoles - è§’è‰²éªŒè¯
```javascript
// å•ä¸ªè§’è‰²
@RequiresRoles('admin')

// å¤šä¸ªè§’è‰²ï¼ˆAND é€»è¾‘ï¼‰
@RequiresRoles(['admin', 'editor'], 'AND')

// å¤šä¸ªè§’è‰²ï¼ˆOR é€»è¾‘ï¼‰
@RequiresRoles(['admin', 'editor'], 'OR')
```

#### @RequiresAuth - ç»„åˆéªŒè¯
```javascript
// åŒæ—¶éªŒè¯è§’è‰²å’Œæƒé™
@RequiresAuth({
  roles: ['admin'],
  permissions: ['system:user:list'],
  logical: 'AND'
})
```

### 4. å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    // ä¸šåŠ¡æ•°æ®
  }
}
```

#### åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "rows": [...],
  "total": 100
}
```

#### é”™è¯¯å“åº”
```json
{
  "code": 500,
  "msg": "é”™è¯¯ä¿¡æ¯"
}
```

### 5. å¸¸ç”¨è¾…åŠ©å‡½æ•°

#### ctx.helper.page() - åˆ†é¡µå‚æ•°
```javascript
// å°†å‰ç«¯ä¼ å…¥çš„ pageNumã€pageSize è½¬æ¢ä¸ºæ•°æ®åº“ offset
const values = ctx.helper.page(ctx.request.body);
// è¿”å›: { offset: 0, pageSize: 10 }
```

#### ctx.helper.formatDate() - æ—¥æœŸæ ¼å¼åŒ–
```javascript
const formattedDate = ctx.helper.formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss');
```

#### ctx.app.cache - ç¼“å­˜æ“ä½œ
```javascript
// è®¾ç½®ç¼“å­˜
await ctx.app.cache.default.set('key', value, { ttl: 600 });

// è·å–ç¼“å­˜
const value = await ctx.app.cache.default.get('key');

// åˆ é™¤ç¼“å­˜
await ctx.app.cache.default.del('key');

// å¸¦å›è°ƒçš„ç¼“å­˜ï¼ˆä¸å­˜åœ¨æ—¶è‡ªåŠ¨æ‰§è¡Œå›è°ƒå¹¶ç¼“å­˜ï¼‰
const value = await ctx.app.cache.default.wrap('key', async () => {
  return await fetchDataFromDb();
}, { ttl: 600 });
```

---

## å¼€å‘å·¥ä½œæµ

### 1. æ–°å¢åŠŸèƒ½æ¨¡å—

#### æ­¥éª¤ 1ï¼šç¼–å†™ Mapper XML
```bash
# åœ¨ mapper/mysql/ruoyi/ ç›®å½•ä¸‹åˆ›å»º XML æ–‡ä»¶
# ä¾‹å¦‚ï¼šSysXxxMapper.xml
```

#### æ­¥éª¤ 2ï¼šè‡ªåŠ¨ç”Ÿæˆ Service
```bash
# å¼€å‘æ¨¡å¼ä¼šè‡ªåŠ¨ç›‘å¬ XML å˜åŒ–å¹¶ç”Ÿæˆä»£ç 
npm run dev

# æˆ–æ‰‹åŠ¨ç”Ÿæˆ
npm run mapper
```

#### æ­¥éª¤ 3ï¼šç¼–å†™ Service ä¸šåŠ¡é€»è¾‘
```bash
# åœ¨ app/service/system/ ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„ Service
# ä¾‹å¦‚ï¼šxxx.js
```

#### æ­¥éª¤ 4ï¼šç¼–å†™ Controller
```bash
# åœ¨ app/controller/system/ ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„ Controller
# ä¾‹å¦‚ï¼šxxx.js
```

#### æ­¥éª¤ 5ï¼šæ·»åŠ æƒé™æ³¨è§£
```javascript
// ä½¿ç”¨ @RequiresPermissions è£…é¥°å™¨æ·»åŠ æƒé™æ§åˆ¶
@RequiresPermissions('system:xxx:list')
```

#### æ­¥éª¤ 6ï¼šæµ‹è¯•æ¥å£
```bash
# ä½¿ç”¨ Postmanã€curl æˆ–å‰ç«¯é¡¹ç›®æµ‹è¯•
```

### 2. ä¿®æ”¹ç°æœ‰åŠŸèƒ½

#### ä¿®æ”¹ SQL
- ç¼–è¾‘ `mapper/mysql/ruoyi/XxxMapper.xml`
- ä¿å­˜åä¼šè‡ªåŠ¨é‡æ–°ç”Ÿæˆ Serviceï¼ˆå¼€å‘æ¨¡å¼ï¼‰

#### ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
- ç¼–è¾‘ `app/service/system/xxx.js`
- æ— éœ€é‡å¯æœåŠ¡ï¼ˆçƒ­é‡è½½ï¼‰

#### ä¿®æ”¹æ¥å£
- ç¼–è¾‘ `app/controller/system/xxx.js`
- æ— éœ€é‡å¯æœåŠ¡ï¼ˆçƒ­é‡è½½ï¼‰

### 3. å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰
npm run dev          # Mapper è‡ªåŠ¨ç”Ÿæˆ + è°ƒè¯•æœåŠ¡ + çƒ­é‡è½½

# å•ç‹¬è¿è¡Œ
npm run mapper       # ä»…ç”Ÿæˆ Mapper Service
npm run debug        # ä»…å¯åŠ¨è°ƒè¯•æœåŠ¡

# ç”Ÿäº§æ¨¡å¼
npm start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡ï¼ˆåå°å®ˆæŠ¤è¿›ç¨‹ï¼‰
npm stop             # åœæ­¢ç”Ÿäº§æœåŠ¡

# å…¶ä»–
npm run lint         # ä»£ç æ£€æŸ¥
npm test             # è¿è¡Œæµ‹è¯•
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®æ–‡ä»¶

- **config.default.js**: æ‰€æœ‰ç¯å¢ƒçš„é»˜è®¤é…ç½®
- **config.local.js**: æœ¬åœ°å¼€å‘é…ç½®ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰
- **config.prod.js**: ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰

### é‡è¦é…ç½®é¡¹

#### JWT é…ç½®
```javascript
config.jwt = {
  enable: true,
  match: /^\/api[\/]?((?!version|login|register|captcha).)*$/i,
  secret: 'z2Em*CpGBZDw+',  // ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
  expiresIn: '7d',
  getToken(ctx) { /* ... */ },
  isRevoked: async (ctx, payload) => { /* ... */ }
};
```

#### æ•°æ®åº“é…ç½®
```javascript
config.mysql = {
  default: {
    port: 3306,
    charset: 'utf8mb4',
    multipleStatements: true,
    connectionLimit: 100,
  },
  clients: {
    ruoyi: {
      host: '127.0.0.1',
      user: 'root',
      password: 'your_password',
      database: 'ruoyi',
    },
  },
};
```

#### ç¼“å­˜é…ç½®
```javascript
config.cache = {
  default: 'redis',  // é»˜è®¤ä½¿ç”¨ Redisï¼Œå¯é€‰ 'memory'ã€'fs'
  ttl: 600,          // é»˜è®¤ TTLï¼ˆç§’ï¼‰
  redis: {
    host: '127.0.0.1',
    port: 6379,
    password: '',
    db: 0,
  },
};
```

#### é™æµé…ç½®
```javascript
config.ratelimiter = {
  points: 100,       // å…è®¸çš„è¯·æ±‚æ¬¡æ•°
  duration: 60,      // æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
  redis: { /* ... */ }
};
```

---

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨

- **sys_user**: ç”¨æˆ·ä¿¡æ¯è¡¨
- **sys_role**: è§’è‰²ä¿¡æ¯è¡¨
- **sys_menu**: èœå•æƒé™è¡¨
- **sys_dept**: éƒ¨é—¨ä¿¡æ¯è¡¨
- **sys_post**: å²—ä½ä¿¡æ¯è¡¨
- **sys_user_role**: ç”¨æˆ·è§’è‰²å…³è”è¡¨
- **sys_role_menu**: è§’è‰²èœå•å…³è”è¡¨
- **sys_role_dept**: è§’è‰²éƒ¨é—¨å…³è”è¡¨
- **sys_user_post**: ç”¨æˆ·å²—ä½å…³è”è¡¨
- **sys_dict_type**: å­—å…¸ç±»å‹è¡¨
- **sys_dict_data**: å­—å…¸æ•°æ®è¡¨
- **sys_config**: å‚æ•°é…ç½®è¡¨
- **sys_notice**: é€šçŸ¥å…¬å‘Šè¡¨
- **sys_logininfor**: ç™»å½•æ—¥å¿—è¡¨
- **sys_oper_log**: æ“ä½œæ—¥å¿—è¡¨
- **sys_job_log**: å®šæ—¶ä»»åŠ¡æ—¥å¿—è¡¨

è¯¦ç»†è®¾è®¡å‚è€ƒï¼š`docs/DATABASE_DESIGN.md`

---

## API è§„èŒƒ

### è·¯ç”±è§„èŒƒ

```
/api/system/æ¨¡å—/æ“ä½œ
```

### HTTP æ–¹æ³•
- **GET**: æŸ¥è¯¢æ“ä½œ
- **POST**: æ–°å¢æ“ä½œ
- **PUT**: ä¿®æ”¹æ“ä½œ
- **DELETE**: åˆ é™¤æ“ä½œ

### æƒé™æ ‡è¯†ç¬¦è§„èŒƒ

```
æ¨¡å—:å­æ¨¡å—:æ“ä½œ
```

ç¤ºä¾‹ï¼š
- `system:user:list` - ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢
- `system:user:query` - ç”¨æˆ·è¯¦æƒ…æŸ¥è¯¢
- `system:user:add` - æ–°å¢ç”¨æˆ·
- `system:user:edit` - ä¿®æ”¹ç”¨æˆ·
- `system:user:remove` - åˆ é™¤ç”¨æˆ·
- `system:role:*` - è§’è‰²æ¨¡å—æ‰€æœ‰æƒé™
- `*:*:*` - æ‰€æœ‰æƒé™ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰

### è¯·æ±‚å‚æ•°
- **åˆ†é¡µå‚æ•°**: `pageNum`ã€`pageSize`
- **æŸ¥è¯¢å‚æ•°**: ä¸æ•°æ®åº“å­—æ®µå¯¹åº”çš„é©¼å³°å‘½å
- **æ—¥æœŸèŒƒå›´**: `beginTime`ã€`endTime`

### å“åº”æ•°æ®
- **åˆ—è¡¨æŸ¥è¯¢**: `{ rows: [], total: 0 }`
- **è¯¦æƒ…æŸ¥è¯¢**: `{ data: {} }`
- **å¢åˆ æ”¹**: `{ code: 200, msg: 'æ“ä½œæˆåŠŸ' }`

---

## å¸¸è§é—®é¢˜

### 1. å¦‚ä½•æ–°å¢ä¸€ä¸ªæ¨¡å—ï¼Ÿ

å‚è€ƒ [å¼€å‘å·¥ä½œæµ - æ–°å¢åŠŸèƒ½æ¨¡å—](#1-æ–°å¢åŠŸèƒ½æ¨¡å—)

### 2. Mapper XML ä¿®æ”¹åæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**æ–¹æ¡ˆ 1**: ç¡®ä¿è¿è¡Œçš„æ˜¯ `npm run dev`ï¼ˆä¼šè‡ªåŠ¨ç›‘å¬å˜åŒ–ï¼‰  
**æ–¹æ¡ˆ 2**: æ‰‹åŠ¨æ‰§è¡Œ `npm run mapper` é‡æ–°ç”Ÿæˆ  
**æ–¹æ¡ˆ 3**: é‡å¯æœåŠ¡

### 3. å¦‚ä½•è°ƒè¯• SQLï¼Ÿ

åœ¨è‡ªåŠ¨ç”Ÿæˆçš„ Service ä¸­ï¼Œå¯ä»¥æ‰“å° SQLï¼š

```javascript
const sql = this.selectUserListMapper(values, params);
ctx.logger.info('SQL:', sql);
```

### 4. å¦‚ä½•æ·»åŠ æƒé™æ§åˆ¶ï¼Ÿ

åœ¨ Controller æ–¹æ³•ä¸Šæ·»åŠ  `@RequiresPermissions` è£…é¥°å™¨ï¼š

```javascript
@RequiresPermissions('system:user:list')
@HttpGet('/list')
async list() { /* ... */ }
```

### 5. å¦‚ä½•ä½¿ç”¨ç¼“å­˜ï¼Ÿ

```javascript
// æ–¹å¼ 1ï¼šç›´æ¥ä½¿ç”¨
await ctx.app.cache.default.set('key', value);
const value = await ctx.app.cache.default.get('key');

// æ–¹å¼ 2ï¼šå¸¦å›è°ƒï¼ˆæ¨èï¼‰
const value = await ctx.app.cache.default.wrap('key', async () => {
  return await fetchData();
});
```

### 6. å¦‚ä½•ä¸Šä¼ æ–‡ä»¶ï¼Ÿ

è°ƒç”¨å…¬å…±ä¸Šä¼ æ¥å£ï¼š`POST /api/common/upload`

```javascript
const formData = new FormData();
formData.append('file', file);
const response = await axios.post('/api/common/upload', formData);
```

### 7. è·¨åŸŸé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ

å·²åœ¨ `config.default.js` ä¸­é…ç½® CORSï¼Œå¦‚éœ€è°ƒæ•´ï¼š

```javascript
config.cors = {
  allowMethods: 'GET,POST,PUT,DELETE',
  credentials: true,
  origin: 'http://localhost:8080',  // é…ç½®å…·ä½“åŸŸå
};
```

### 8. å¦‚ä½•è·å–å½“å‰ç™»å½•ç”¨æˆ·ï¼Ÿ

åœ¨ Controller æˆ– Service ä¸­ï¼š

```javascript
const user = ctx.state.user;
const userId = user.userId;
const userName = user.userName;
```

### 9. Optional Chaining è¯­æ³•é”™è¯¯ï¼Ÿ

Node.js 20+ æ”¯æŒå¯é€‰é“¾ï¼Œä½†å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ”¹ä¸ºï¼š

```javascript
// ä¸æ¨è
const value = obj?.prop?.value;

// æ¨è
const obj2 = obj || {};
const prop = obj2.prop || {};
const value = prop.value;
```

### 10. å¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ

å‚è€ƒ [éƒ¨ç½²è¯´æ˜](#éƒ¨ç½²è¯´æ˜)ï¼Œæ¨èä½¿ç”¨ PM2 æˆ– Dockerã€‚

---

## å¼€å‘å»ºè®®

### ä»£ç è´¨é‡
1. **éµå¾ª ESLint è§„èŒƒ**: ä¿æŒä»£ç é£æ ¼ä¸€è‡´
2. **æ·»åŠ æ³¨é‡Š**: å¤æ‚é€»è¾‘å¿…é¡»æ·»åŠ æ³¨é‡Š
3. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸
4. **æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œè®°å½•æ—¥å¿—ï¼ˆ`ctx.logger`ï¼‰

### å®‰å…¨æ€§
1. **JWT Secret**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
2. **SQL æ³¨å…¥**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆMyBatis è‡ªåŠ¨å¤„ç†ï¼‰
3. **XSS é˜²æŠ¤**: å‰ç«¯è¾“å…¥éªŒè¯å’Œè½¬ä¹‰
4. **æƒé™æ§åˆ¶**: æ‰€æœ‰æ•æ„Ÿæ¥å£æ·»åŠ  `@RequiresPermissions`
5. **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcryptjs åŠ å¯†å­˜å‚¨

### æ€§èƒ½ä¼˜åŒ–
1. **ä½¿ç”¨ç¼“å­˜**: é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜
2. **åˆ†é¡µæŸ¥è¯¢**: å¤§æ•°æ®é‡å¿…é¡»åˆ†é¡µ
3. **ç´¢å¼•ä¼˜åŒ–**: æ•°æ®åº“è¡¨æ·»åŠ åˆé€‚çš„ç´¢å¼•
4. **è¿æ¥æ± **: é…ç½®åˆç†çš„æ•°æ®åº“è¿æ¥æ± å¤§å°
5. **é™æµä¿æŠ¤**: é«˜é¢‘æ¥å£å¯ç”¨é™æµ

### å¯ç»´æŠ¤æ€§
1. **æ¨¡å—åŒ–**: åŠŸèƒ½æŒ‰æ¨¡å—åˆ’åˆ†
2. **å‘½åè§„èŒƒ**: ç»Ÿä¸€çš„å‘½åé£æ ¼
3. **æ–‡æ¡£å®Œå–„**: åŠæ—¶æ›´æ–°æ–‡æ¡£
4. **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†
5. **å•å…ƒæµ‹è¯•**: æ ¸å¿ƒåŠŸèƒ½ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## å¿«é€Ÿå‚è€ƒ

### è£…é¥°å™¨

| è£…é¥°å™¨ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `@Route` | å®šä¹‰è·¯ç”±å‰ç¼€ | `@Route('/api/system/user')` |
| `@HttpGet` | GET è¯·æ±‚ | `@HttpGet('/list')` |
| `@HttpPost` | POST è¯·æ±‚ | `@HttpPost('/')` |
| `@HttpPut` | PUT è¯·æ±‚ | `@HttpPut('/')` |
| `@HttpDelete` | DELETE è¯·æ±‚ | `@HttpDelete('/:ids')` |
| `@RequiresPermissions` | æƒé™éªŒè¯ | `@RequiresPermissions('system:user:list')` |
| `@RequiresRoles` | è§’è‰²éªŒè¯ | `@RequiresRoles('admin')` |
| `@RequiresAuth` | ç»„åˆéªŒè¯ | `@RequiresAuth({roles: ['admin']})` |

### å¸¸ç”¨è·¯å¾„

```javascript
// Controller
ctx.service.system.user
ctx.service.monitor.cache
ctx.service.tool.gen

// è‡ªåŠ¨ç”Ÿæˆçš„ DB Service
ctx.service.db.mysql.ruoyi.sysUserMapper
ctx.service.db.mysql.ruoyi.sysRoleMapper

// Helper
ctx.helper.page()
ctx.helper.formatDate()

// Cache
ctx.app.cache.default.get()
ctx.app.cache.default.set()

// Logger
ctx.logger.info()
ctx.logger.error()
ctx.logger.warn()

// å½“å‰ç”¨æˆ·
ctx.state.user
```

### æ–‡æ¡£ç´¢å¼•

- **API æ˜ å°„**: `docs/API_MAPPING.md`
- **æƒé™æ§åˆ¶**: `docs/PERMISSION_GUIDE.md`
- **è®¤è¯æˆæƒ**: `docs/AUTH_MODULE_README.md`
- **å¿«é€Ÿå¼€å§‹**: `docs/QUICK_START_AUTH.md`
- **å„æ¨¡å— API**: `docs/*_MANAGEMENT_API.md`
- **é¡¹ç›®åˆ†æ**: `docs/PROJECT_ANALYSIS_SUMMARY.md`
- **æ¶æ„å¯¹æ¯”**: `docs/ARCHITECTURE_COMPARISON.md`

---

## AI è¾…åŠ©æç¤º

å½“ä½¿ç”¨ AI è¾…åŠ©å¼€å‘æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **æ˜ç¡®éœ€æ±‚**: æ¸…æ¥šè¯´æ˜è¦å®ç°çš„åŠŸèƒ½
2. **æä¾›ä¸Šä¸‹æ–‡**: æŒ‡å®šç›¸å…³çš„æ¨¡å—å’Œæ–‡ä»¶
3. **éµå¾ªè§„èŒƒ**: ç”Ÿæˆçš„ä»£ç åº”ç¬¦åˆé¡¹ç›®è§„èŒƒ
4. **æƒé™æ§åˆ¶**: æ–°å¢æ¥å£ä¸è¦å¿˜è®°æ·»åŠ æƒé™æ³¨è§£
5. **å®Œæ•´å®ç°**: Controllerã€Serviceã€Mapper ä¸‰å±‚éƒ½è¦å®ç°
6. **æµ‹è¯•éªŒè¯**: ç”Ÿæˆä»£ç åéœ€è¦æµ‹è¯•éªŒè¯

### å¸¸ç”¨ AI æŒ‡ä»¤ç¤ºä¾‹

```
# æ–°å¢æ¨¡å—
"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå•†å“ç®¡ç†æ¨¡å—ï¼ŒåŒ…æ‹¬ Controllerã€Service å’Œ Mapper XMLï¼Œ
æ”¯æŒå¢åˆ æ”¹æŸ¥å’Œåˆ†é¡µï¼Œæƒé™æ ‡è¯†ç¬¦ä½¿ç”¨ system:goods:*"

# ä¿®æ”¹åŠŸèƒ½
"ä¿®æ”¹ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢æ¥å£ï¼Œå¢åŠ æŒ‰éƒ¨é—¨ ID ç­›é€‰çš„åŠŸèƒ½"

# æ·»åŠ æƒé™
"ä¸ºæ‰€æœ‰ç³»ç»Ÿç®¡ç†æ¨¡å—çš„ Controller æ·»åŠ  @RequiresPermissions è£…é¥°å™¨"

# ä¼˜åŒ–æ€§èƒ½
"ä¼˜åŒ–ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢çš„ SQLï¼Œæ·»åŠ ç´¢å¼•å’Œç¼“å­˜"

# ä¿®å¤ Bug
"ä¿®å¤ç™»å½•æ—¥å¿—æŸ¥è¯¢æ—¶æ—¥æœŸèŒƒå›´ç­›é€‰ä¸ç”Ÿæ•ˆçš„é—®é¢˜"
```

---

